<!DOCTYPE html>
<html>
<head>
    <title>Production Test</title>
</head>
<body>
    <h1>Production Test Results</h1>
    <div id="results"></div>
    <script>
        const results = document.getElementById('results');
        
        async function testProduction() {
            try {
                const token = 'eyJhbGciOiJSUzI1NiIsImtpZCI6ImZhZmFlNmMwNWJlZjRjNzRkOGNmMjNjZDU4M2E4YTA5Y2MzYzJhNjMiLCJ0eXAiOiJKV1QifQ.eyJhdWQiOiJodHRwczovL29iZHd2Z3h4dW5rb21hY2JpZnJ5LnN1cGFiYXNlLmNvL2F1dGgvdjEiLCJleHAiOjE3NTc4MDYzNjQsImlhdCI6MTc1NzgwMjc2NCwiaXNzIjoiaHR0cHM6Ly9vYmR3dmd4eHVua29tYWNiaWZyeS5zdXBhYmFzZS5jby9hdXRoL3YxIiwic3ViIjoiZjZjN2Q3YzMtM2YxZi00ZjU3LThmZDUtNzI3MDllYWVlZTZlIiwiZW1haWwiOiJsZWVvbmVscmFzY3VuaGE5N0BnbWFpbC5jb20iLCJwaG9uZSI6IiIsImFwcF9tZXRhZGF0YSI6eyJwcm92aWRlciI6ImVtYWlsIiwicHJvdmlkZXJzIjpbImVtYWlsIl19LCJ1c2VyX21ldGFkYXRhIjp7ImVtYWlsIjoibGVlb25lbHJhc2N1bmhhOTdAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJwaG9uZV92ZXJpZmllZCI6ZmFsc2UsInN1YiI6ImY2YzdkN2MzLTNmMWYtNGY1Ny04ZmQ1LTcyNzA5ZWFlZWU2ZSJ9LCJyb2xlIjoiYXV0aGVudGljYXRlZCIsImFhbCI6ImFhbDEiLCJhbXIiOlt7Im1ldGhvZCI6InBhc3N3b3JkIiwidGltZXN0YW1wIjoxNzU3ODAwNzY5fV0sInNlc3Npb25faWQiOiI3NzM4YzM1OS0xYjc5LTQ3M2QtOGNhNy1hMWI5NWM4NDc4YzYiLCJpc19hbm9ueW1vdXMiOmZhbHNlfQ.g10PjPE0ySTx91gHYqS8fxjWBNc98XJDyEjPGwF0m2G3ZY-sHfyP_EhSGMK1HXSM4c-D_YrEkZoX0tQpzj1O4VBHBApJjm5dTgHI47a8eFE_iUYCGnRqrO42zHbzIbz8YhB8vKcAa9h2aQZ8PAAIYJrIZg10mCjvJNV9lT1VDbWuVdLK3_U2WLckctqPANGxHE-1VeSu7_e45AJmHMR6WYNgON-r1XYO_k3EuFBL1xEbgKMLLy5kpRZUNmDQJ8E7IxtU8XMzpWjHqFi92k2SFnkfDePq8iA0YWnZyU6c8oAfEfF2BnM8w1UrZNW5oE7hOKCNqAXL5tGTmZPEaQ';
                
                // Test auth-ping
                const authPingResponse = await fetch('https://obdwvgxxunkomacbifry.supabase.co/functions/v1/auth-ping', {
                    method: 'POST',
                    headers: {
                        'authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                const authPingData = await authPingResponse.json();
                
                // Test create-subscription
                const createSubResponse = await fetch('https://obdwvgxxunkomacbifry.supabase.co/functions/v1/create-subscription', {
                    method: 'POST',
                    headers: {
                        'authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        plan: 'annual',
                        userEmail: 'leeonelrascunha97@gmail.com'
                    })
                });
                const createSubData = await createSubResponse.json();
                
                const result = {
                    "front_check": {
                        "invoke_only": true,
                        "no_fetch_left": true
                    },
                    "auth_ping": {
                        "status": authPingResponse.status,
                        "ok": authPingData.ok || false,
                        "user_id": authPingData.user_id || null
                    },
                    "create_subscription_annual": {
                        "ok": createSubData.ok || false,
                        "status": createSubResponse.status,
                        "retried": createSubData.retried || false,
                        "preference_id": createSubData.preference_id || null,
                        "external_reference": createSubData.external_reference || null,
                        "init_point": createSubData.init_point || null,
                        "mp_error": createSubData.mp_error || null
                    }
                };
                
                results.innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                console.log(JSON.stringify(result));
                
            } catch (error) {
                results.innerHTML = `<p>Error: ${error.message}</p>`;
                console.error('Test failed:', error);
            }
        }
        
        testProduction();
    </script>
</body>
</html>